import{Y as N,r as d,g,m as F,Z as u}from"./DFAwYgtM.js";const L=N("localStorage",()=>({getFromLocalStorage:i=>{try{const r=window.localStorage.getItem(i);return r?JSON.parse(r):null}catch(r){return console.error(`Failed to parse data for key: ${i}`,r),null}},saveToLocalStorage:(i,r)=>{window.localStorage.setItem(i,JSON.stringify(r))}})),$=N("notes",()=>{const o=d([{id:1,title:"Покупки",tasks:[{id:101,text:"Купить хлеб",isCompleted:!1},{id:102,text:"Купить молоко",isCompleted:!0}]},{id:2,title:"Рабочие задачи",tasks:[{id:201,text:"Написать отчет",isCompleted:!1},{id:202,text:"Проверить почту",isCompleted:!0},{id:203,text:"Позвонить клиенту",isCompleted:!1}]},{id:3,title:"Состав плова",tasks:[{id:301,text:"Рис",isCompleted:!1},{id:302,text:"Мясо",isCompleted:!0},{id:303,text:"Морковь",isCompleted:!1}]},{id:4,title:"Утренняя рутина",tasks:[{id:401,text:"Проснуться",isCompleted:!0},{id:402,text:"Сделать зарядку",isCompleted:!1},{id:403,text:"Позавтракать",isCompleted:!1}]},{id:5,title:"Подготовка к отпуску",tasks:[{id:501,text:"Купить билеты",isCompleted:!0},{id:502,text:"Собрать чемодан",isCompleted:!1},{id:503,text:"Оформить страховку",isCompleted:!1}]},{id:6,title:"Учебный план",tasks:[{id:601,text:"Прочитать главу по Vue.js",isCompleted:!1},{id:602,text:"Посмотреть урок по TypeScript",isCompleted:!1},{id:603,text:"Решить задачи по алгоритмам",isCompleted:!1}]}]),c=L(),i=()=>{const e=c.getFromLocalStorage("notes");console.log("storedNotes: ",e),Array.isArray(e)?o.value=e:console.warn("Invalid data in localStorage, resetting to default")},r=()=>{i()},f=()=>{c.saveToLocalStorage("notes",o.value)},t=d({}),p=e=>{if(e){const s=o.value.find(n=>n.id===e);s&&(t.value=JSON.parse(JSON.stringify(s)),v(t.value))}},m=()=>{t.value={id:null,title:"",tasks:[{id:null,text:"New task",isCompleted:!1}]}},x=()=>{const e={id:null,text:"New Task",isCompleted:!1};t.value.tasks.push(e)},k=(e,s)=>{const n=t.value.tasks.findIndex(T=>T.id===e);n!==-1&&(t.value.tasks[n]={...t.value.tasks[n],...s})},y=e=>{o.value=o.value.filter(s=>s.id!==e),f()},C=e=>{t.value.tasks=t.value.tasks.filter(s=>s.id!==e)},J=()=>{i();const e=o.value.findIndex(s=>s.id===t.value.id);e>-1?o.value[e]=JSON.parse(JSON.stringify(t.value)):(t.value.id=S(),t.value.tasks.forEach((s,n)=>{s.id=O(t.value.id,n)}),o.value.push(t.value)),f()},S=()=>o.value.length>0?o.value[o.value.length-1].id+1:1,O=(e,s)=>`${e}_${s+1}`,l=d(-1),a=d([]),v=e=>{l.value<a.value.length-1&&JSON.stringify(t.value)!==JSON.stringify(a.value[a.value.length-1])&&(a.value=a.value.slice(0,l.value+1).map(s=>JSON.parse(JSON.stringify(s))),console.log("currentStep IF: ",l.value),console.log("history IF: ",u(a.value))),JSON.stringify(t.value)!==JSON.stringify(a.value[a.value.length-1])&&(a.value.push(JSON.parse(JSON.stringify(e))),l.value++)},h=()=>{l.value>0&&(l.value--,t.value=JSON.parse(JSON.stringify(a.value[l.value])))},w=()=>{l.value<a.value.length-1&&(l.value++,t.value=a.value[l.value])},I=()=>{a.value=[],l.value=-1};return g(t,(e,s)=>{console.group("watch: currentNote IN"),console.log("newNote: ",u(e)),console.log("oldNote: ",u(s)),console.log("currentNote: ",u(t.value)),console.log("history: ",u(a.value)),console.log("currentStep: ",l.value),JSON.stringify(s)===JSON.stringify(e)&&v(e),console.groupEnd()},{deep:!0}),g(o,e=>{e&&p("prepareNoteForEditing: ",t.value.id)},{deep:!0}),g(l,e=>{}),F(()=>{i()}),{notes:o,currentNote:t,currentStep:l,history:a,init:r,deleteTask:C,createNewTask:x,generateNoteId:S,createNewNote:m,updateTask:k,deleteNote:y,loadNotesFromLocalStorage:i,saveNote:J,prepareNoteForEditing:p,updateNote:v,undo:h,redo:w,resetHistory:I}});export{$ as u};
