import{Y as p,r as c,g as d,m as x,Z as i}from"./7dZDTWwZ.js";const E=p("localStorage",()=>({getFromLocalStorage:r=>{try{const n=window.localStorage.getItem(r);return n?JSON.parse(n):null}catch(n){return console.error(`Failed to parse data for key: ${r}`,n),null}},saveToLocalStorage:(r,n)=>{window.localStorage.setItem(r,JSON.stringify(n))}})),A=p("notes",()=>{const s=c([{id:1,title:"Note #1",tasks:[{id:101,text:"New Task",isCompleted:!1}]}]),v=E(),r=()=>{const e=v.getFromLocalStorage("notes");console.log("storedNotes: ",e),Array.isArray(e)?s.value=e:console.warn("Invalid data in localStorage, resetting to default")},n=()=>{r()},S=()=>{v.saveToLocalStorage("notes",s.value)},t=c({}),N=e=>{if(e){const o=s.value.find(u=>u.id===e);o&&(t.value=JSON.parse(JSON.stringify(o)),g(t.value))}},y=()=>{t.value={id:null,title:"",tasks:[]}},O=()=>{const e={id:null,text:"New Task",isCompleted:!1};t.value.tasks.push(e)},h=(e,o)=>{const u=t.value.tasks.findIndex(L=>L.id===e);u!==-1&&(t.value.tasks[u]={...t.value.tasks[u],...o})},J=e=>{s.value=s.value.filter(o=>o.id!==e),S()},k=e=>{t.value.tasks=t.value.tasks.filter(o=>o.id!==e)},w=()=>{r();const e=s.value.findIndex(o=>o.id===t.value.id);e>-1?s.value[e]=JSON.parse(JSON.stringify(t.value)):(t.value.id=f(),t.value.tasks.forEach((o,u)=>{o.id=m(t.value.id,u)}),s.value.push(t.value)),S()},f=()=>s.value.length>0?s.value[s.value.length-1].id+1:1,m=(e,o)=>`${e}_${o+1}`,l=c(-1),a=c([]),g=e=>{l.value<a.value.length-1&&JSON.stringify(t.value)!==JSON.stringify(a.value[a.value.length-1])&&(a.value=a.value.slice(0,l.value+1).map(o=>JSON.parse(JSON.stringify(o))),console.log("currentStep IF: ",l.value),console.log("history IF: ",i(a.value))),JSON.stringify(t.value)!==JSON.stringify(a.value[a.value.length-1])&&(a.value.push(JSON.parse(JSON.stringify(e))),l.value++)},T=()=>{l.value>0&&(l.value--,t.value=JSON.parse(JSON.stringify(a.value[l.value])))},I=()=>{l.value<a.value.length-1&&(l.value++,t.value=a.value[l.value])},F=()=>{a.value=[],l.value=-1};return d(t,(e,o)=>{console.group("watch: currentNote IN"),console.log("newNote: ",i(e)),console.log("oldNote: ",i(o)),console.log("currentNote: ",i(t.value)),console.log("history: ",i(a.value)),console.log("currentStep: ",l.value),console.groupEnd(),JSON.stringify(o)===JSON.stringify(e)&&g(e),console.group("watch: currentNote OUT"),console.log("currentNote: ",i(t.value)),console.log("history: ",i(a.value)),console.log("currentStep: ",l.value),console.groupEnd()},{deep:!0}),d(s,e=>{e&&N("prepareNoteForEditing: ",t.value.id)},{deep:!0}),d(l,e=>{}),x(()=>{r()}),{notes:s,currentNote:t,currentStep:l,history:a,init:n,deleteTask:k,createNewTask:O,generateNoteId:f,createNewNote:y,updateTask:h,deleteNote:J,loadNotesFromLocalStorage:r,saveNote:w,prepareNoteForEditing:N,updateNote:g,undo:T,redo:I,resetHistory:F}});export{A as u};
